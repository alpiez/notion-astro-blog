---
import { isFullBlock } from "@notionhq/client";
import type { ListBlockChildrenResponse } from "@notionhq/client/build/src/api-endpoints";
import Paragraph from "./notion_blocks/paragraph.astro";
import Heading1 from "./notion_blocks/heading_1.astro";
import Heading2 from "./notion_blocks/heading_2.astro";
import Heading3 from "./notion_blocks/heading_3.astro";
import BulletedList from "./notion_blocks/bulleted_list.astro";
import NumberedList from "./notion_blocks/numbered_list.astro";

interface Props {
  response: ListBlockChildrenResponse;
}

// For bullet list count
let bulletCount = 1;

const { response } = Astro.props;
---

<>
  {
    response.results?.map((result) => {
      if (isFullBlock(result)) {
        // Reset bullet list count if the block is no longer bullet list
        if (result.type != "numbered_list_item" && bulletCount > 1)
          bulletCount = 1;

        // Pick suitable component based on its notion block type
        switch (result.type) {
          case "paragraph":
            return <Paragraph content={result} />;
          case "heading_1":
            return <Heading1 content={result} />;
          case "heading_2":
            return <Heading2 content={result} />;
          case "heading_3":
            return <Heading3 content={result} />;
          case "bulleted_list_item":
            return <BulletedList content={result} />;
          case "numbered_list_item":
            return <NumberedList content={result} count={bulletCount++} />;
          default:
            "";
        }
      }
    })
  }
</>
